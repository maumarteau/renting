(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-89ca9eec"],{"4d8f":function(t,e,n){},"502e":function(t,e,n){"use strict";var a=n("2b0e");e["a"]=a["default"].mixin({data:function(){return{API_URL:"https://lestido-api.herokuapp.com"}},methods:{parseGQLErrors:function(t){var e;return t.graphQLErrors&&(e=t.graphQLErrors[0]?t.graphQLErrors[0].message:null),t.networkError&&!e&&(e=t.networkError.result.errors[0]?t.networkError.result.errors[0].message:null),t.message&&!e&&(e=t.message),e||(e="Ha ocurrido un error"),this.$toast.error(e),e}}})},"9e68":function(t,e,n){"use strict";n("4d8f")},a0c5:function(t,e,n){"use strict";n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");var a=n("06c5");function i(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Object(a["a"])(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){c=!0,r=t},f:function(){try{o||null==n["return"]||n["return"]()}finally{if(c)throw r}}}}n("b0c0");var s=n("2b0e");e["a"]=s["default"].mixin({data:function(){return{saving:!1}},methods:{covertArrayToSelectableObject:function(t){var e,n=[],a=i(t);try{for(a.s();!(e=a.n()).done;){var s=e.value;n.push({value:s.id,label:s.name})}}catch(r){a.e(r)}finally{a.f()}return n}}})},efab:function(t,e,n){"use strict";n.r(e);var a,i,s,r,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Layout",{attrs:{loading:t.loading,pageTitle:t.title},scopedSlots:t._u([{key:"cta",fn:function(){},proxy:!0}])},[n("div",{staticClass:"main-container"},[n("div",{staticClass:"card mt-2"},[n("div",{staticClass:"card-body"},[n("FormulateForm",{ref:"form",on:{submit:t.save},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}},[n("FormulateInput",{attrs:{label:"Nombre",name:"name","validation-name":"Nombre",validation:"required"}}),n("FormulateInput",{attrs:{label:"Apellido",name:"lastname","validation-name":"Apellido",validation:"required"}}),n("FormulateInput",{attrs:{label:"Email",type:"email",name:"email","validation-name":"Email",validation:"required"}}),n("FormulateInput",{attrs:{label:"Teléfono",type:"phone",name:"phone","validation-name":"Teléfono",validation:"optional|^phone"}}),t.offices?n("FormulateInput",{attrs:{label:"Oficina","validation-name":"Oficina",name:"office",options:t.offices,type:"selectSearch","option-value":"id","option-text":"name",placeholder:"Seleccione una oficina",validation:"required"}}):t._e(),n("div",{staticClass:"label"},[t._v("Permisos")]),t._l(t.permissionsSections,(function(e,a){return n("div",{key:e.id,staticClass:"w-100 border-bottom p-3"},[n("div",{staticClass:"d-flex justify-content-between"},[n("h5",[n("small",[t._v(t._s(e.name))])]),n("div",[n("b-form-radio-group",{on:{change:function(e){return t.permissionAccessChanged(a)}},model:{value:e.access,callback:function(n){t.$set(e,"access",n)},expression:"section.access"}},[n("b-form-radio",{attrs:{value:"FULL"}},[t._v("Full")]),n("b-form-radio",{attrs:{value:"SOME"}},[t._v("Parcial")]),n("b-form-radio",{attrs:{value:"NONE"}},[t._v("Ninguno")])],1)],1)]),n("b-collapse",{staticClass:"mt-2",attrs:{visible:"SOME"==e.access}},[n("div",{staticClass:"list-group"},t._l(e.permissions,(function(e){return n("div",{key:e.id,staticClass:"item"},[n("FormulateInput",{staticClass:"mr-2",attrs:{type:"checkbox"},model:{value:e.selected,callback:function(n){t.$set(e,"selected",n)},expression:"permission.selected"}}),n("div",{staticClass:"flex-grow-1",on:{click:function(t){e.selected=!e.selected}}},[n("h6",[t._v(t._s(e.name))]),e.description?n("p",{staticClass:"text-secondary"},[t._v(t._s(e.description))]):t._e()])],1)})),0)])],1)})),n("div",{staticClass:"d-flex justify-content-between mt-4"},[n("FormulateInput",{attrs:{type:"button","data-ghost":""},on:{click:function(e){return t.$router.go(-1)}}},[t._v("Cancelar")]),t.saving?n("FormulateInput",{attrs:{type:"button",disabled:""}},[t._v("Guardando "),n("span",{staticClass:"loader"})]):n("FormulateInput",{attrs:{type:"submit",label:t.title}})],1)],2)],1)])])])},c=[],l=n("5530"),u=n("8785"),d=n("1da1"),m=(n("159b"),n("d81d"),n("b0c0"),n("4de4"),n("96cf"),n("9530")),f=n.n(m),p=n("502e"),h=n("a0c5"),v={name:"UserForm",mixins:[p["a"],h["a"]],data:function(){return{title:"Crear usuario",action:"create",loading:!1,form:{name:null,lastname:null,email:null,phone:null,password:null,passwordConfirm:null},offices:[],permissionsSections:[]}},beforeMount:function(){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.fetchData();case 3:if(t.offices=e.sent,!t.$route.params.id){e.next=9;break}return t.action="update",t.title="Editar usuario",e.next=9,t.load();case 9:t.loading=!1;case 10:case"end":return e.stop()}}),e)})))()},methods:{save:function(){if(!this.saving){this.saving=!0;var t={};this.permissionsSections.forEach((function(e){e.permissions.map((function(e){return t[e.permission]=e.selected}))}));var e={name:this.form.name,lastname:this.form.lastname,email:this.form.email,phone:this.form.phone,office:this.form.office?this.form.office.id:null,password:this.form.password,permissions:t};"create"==this.action&&this.create(e),"update"==this.action&&this.update(e)}},create:function(t){var e=this;this.$apollo.mutate({mutation:f()(a||(a=Object(u["a"])(["mutation ( $data:UserInput! ){\n\t\t\t\t\tuserCreate( data: $data) {\n\t\t\t\t\t\tid\n\t\t\t\t\t}\n\t\t\t\t}"]))),variables:{data:t}}).then((function(){e.$toast.success("Usuario creado correctamente"),e.$router.go(-1),e.saving=!1})).catch((function(t){e.parseGQLErrors(t),e.saving=!1}))},update:function(t){var e=this;this.$apollo.mutate({mutation:f()(i||(i=Object(u["a"])(["mutation ( $id: ID!, $data:UserInput! ){\n\t\t\t\t\tuserUpdate( id: $id, data: $data) {\n\t\t\t\t\t\tid\n\t\t\t\t\t}\n\t\t\t\t}"]))),variables:{id:this.$route.params.id,data:t}}).then((function(){e.$toast.success("Usuario editado correctamente"),e.$router.go(-1),e.saving=!1})).catch((function(t){e.errors=e.parseGQLErrors(t),e.saving=!1}))},fetchData:function(){return this.$apollo.query({query:f()(s||(s=Object(u["a"])(["query {\n\t\t\t\t\toffices {\n\t\t\t\t\t\tdata{\n\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\tname\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}"]))),fetchPolicy:"network-only"}).then((function(t){var e=t.data;return e.offices.data})).catch((function(t){console.log(t)}))},load:function(){var t=this;return this.loading=!0,this.$apollo.query({query:f()(r||(r=Object(u["a"])(["query ($id: ID!) {\n\t\t\t\t\tuser(id: $id) {\n\t\t\t\t\t\tid\n\t\t\t\t\t\tname\n\t\t\t\t\t\tlastname\n\t\t\t\t\t\temail\n\t\t\t\t\t\tphone{\n\t\t\t\t\t\t\tcountryCode\n\t\t\t\t\t\t\tnational\n\t\t\t\t\t\t\tinternational\n\t\t\t\t\t\t\ttype\n\t\t\t\t\t\t\tvalidated\n\t\t\t\t\t\t}\n\t\t\t\t\t\toffice{ id }\n\t\t\t\t\t\tpermissions\n\t\t\t\t\t}\n\t\t\t\t\tpermissionSections{\n\t\t\t\t\t\tid\n\t\t\t\t\t\tname\n\t\t\t\t\t\tpermissions{\n\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\tname\n\t\t\t\t\t\t\tpermission\n\t\t\t\t\t\t\tdescription\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}"]))),variables:{id:this.$route.params.id},fetchPolicy:"network-only"}).then((function(e){var n=e.data;t.form=Object(l["a"])({},t.$omitDeep(n.user,"__typename")),t.parsePermissions(n.permissionSections,n.user.permissions),t.loading=!1})).catch((function(e){t.$toast.success("El item que desea editar no existe")}))},parsePermissions:function(t,e){t=t.map((function(t){var n=t.permissions.map((function(t){console.log(t.permission),t.selected=e[t.permission]})),a=t.permissions.filter((function(t){return 1==t.selected})),i="NONE";return n.length&&(i=a.length==n.length?"FULL":a.length>0?"SOME":"NONE"),Object(l["a"])(Object(l["a"])(Object(l["a"])({},t),n),{},{access:i})})),this.permissionsSections=t},permissionAccessChanged:function(t){"NONE"==this.permissionsSections[t].access&&this.permissionsSections[t].permissions.map((function(t){return t.selected=!1})),"FULL"==this.permissionsSections[t].access&&this.permissionsSections[t].permissions.map((function(t){return t.selected=!0}))}}},b=v,g=(n("9e68"),n("2877")),y=Object(g["a"])(b,o,c,!1,null,"dba76f48",null);e["default"]=y.exports}}]);
//# sourceMappingURL=chunk-89ca9eec.6a43c3a1.js.map